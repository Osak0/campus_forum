<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>发布新帖</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <header class="app-header">
        <a href="index.html" class="back-btn">取消</a>
        <h1 class="page-title">发布帖子</h1>
        <button id="submit-post-btn" class="text-btn">发布</button>
    </header>

    <main class="app-content" style="background: white;">
        <div class="post-form">
            <input type="text" id="title-input" placeholder="请输入标题" class="form-title">
            <textarea id="content-input" placeholder="分享你的新鲜事..." class="form-content"></textarea>
        </div>
    </main>

    <!-- 引入 JS -->
    <script>
        const API_BASE_URL = "http://127.0.0.1:8000";

        document.getElementById('submit-post-btn').addEventListener('click', async () => {
            const title = document.getElementById('title-input').value.trim();
            const content = document.getElementById('content-input').value.trim();

            if (!title || !content) {
                alert('标题和内容不能为空');
                return;
            }

            // TODO: 同样需要登录信息，暂时写死
            const authorEmail = "zhangsan@xjtu.edu.cn";

            try {
                const res = await fetch(`${API_BASE_URL}/posts/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        author_email: authorEmail,
                        title: title,
                        content: content
                    })
                });

                if (res.ok) {
                    alert('发布成功！');
                    window.location.href = 'index.html'; // 跳回主页
                } else {
                    const err = await res.json();
                    alert('发布失败: ' + (err.detail || '未知错误'));
                }
            } catch (error) {
                alert('网络错误，请检查后端是否启动');
            }
        });
    </script>
</body>

</html>